{"version":3,"file":"builder.js","sources":["../node_modules/backed-logger/dist/logger-es.js","../src/builder.js"],"sourcesContent":["var classCallCheck = function (instance, Constructor) {\n  if (!(instance instanceof Constructor)) {\n    throw new TypeError(\"Cannot call a class as a function\");\n  }\n};\n\nvar createClass = function () {\n  function defineProperties(target, props) {\n    for (var i = 0; i < props.length; i++) {\n      var descriptor = props[i];\n      descriptor.enumerable = descriptor.enumerable || false;\n      descriptor.configurable = true;\n      if (\"value\" in descriptor) descriptor.writable = true;\n      Object.defineProperty(target, descriptor.key, descriptor);\n    }\n  }\n\n  return function (Constructor, protoProps, staticProps) {\n    if (protoProps) defineProperties(Constructor.prototype, protoProps);\n    if (staticProps) defineProperties(Constructor, staticProps);\n    return Constructor;\n  };\n}();\n\nvar chalk = require('chalk');\n\nvar Logger = function () {\n  function Logger() {\n    classCallCheck(this, Logger);\n  }\n\n  createClass(Logger, [{\n    key: '_chalk',\n    value: function _chalk(text) {\n      var color = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 'white';\n\n      return chalk[color](text);\n    }\n  }, {\n    key: 'log',\n    value: function log(text) {\n      console.log(this._chalk(text));\n    }\n  }, {\n    key: 'warn',\n    value: function warn(text) {\n      console.warn(this._chalk(text, 'yellow'));\n    }\n  }, {\n    key: 'error',\n    value: function error(text) {\n      console.error(this._chalk(text, 'red'));\n    }\n  }, {\n    key: 'succes',\n    value: function succes(text) {\n      console.log(this._chalk(text, 'cyan'));\n    }\n  }]);\n  return Logger;\n}();\n\nvar logger = new Logger();\n\nexport default logger;\n//# sourceMappingURL=logger-es.js.map\n","  'use strict';\n  const {rollup} = require('rollup');\n  const path = require('path');\n  const {fork} = require('child_process');\n  import logger from './../node_modules/backed-logger/dist/logger-es.js';\n  let iterator;\n  let cache;\n  let warnings = [];\n\n  const logWorker = fork(path.join(__dirname, 'workers/log-worker.js'));\n\n  function * bundler(bundles, fn) {\n    for (let bundle of bundles) {\n      let dest = bundle.dest;\n      let format = bundle.format;\n      bundle = bundle.bundle || bundle;\n      bundle.dest = dest;\n      bundle.format = format;\n      yield fn(bundle);\n    }\n    logWorker.kill('SIGINT');\n    if (global.debug) {\n      for (let warning of warnings) {\n        logger.warn(warning);\n      }\n    }\n  }\n  export default class Builder {\n\n    constructor(config) {\n      logWorker.send(logger._chalk('building', 'cyan'));\n      logWorker.send('start');\n      this.build(config);\n    }\n\n    /**\n     * convert hyphen to a javascript property srting\n     */\n    toJsProp(string) {\n      let parts = string.split('-');\n      if (parts.length > 1) {\n        string = parts[0];\n        for (let part of parts) {\n          if (parts[0] !== part) {\n            var upper = part.charAt(0).toUpperCase();\n            string += upper + part.slice(1).toLowerCase();\n          }\n        }\n      }\n      return string;\n    }\n\n    build(config) {\n      this.promiseBundles(config).then(bundles => {\n        iterator = bundler(bundles, this.bundle);\n        iterator.next();\n      }).catch(error => {\n        logger.warn(error);\n      });\n    }\n\n    handleFormats(bundle, format) {\n      return new Promise((resolve, reject) => {\n        try {\n          let dest = bundle.dest;\n          if (format === 'iife' && !bundle.moduleName) {\n            bundle.moduleName = this.toJsProp(bundle.name);\n          } else {\n            switch (format) {\n              case 'cjs':\n                dest = bundle.dest.replace('.js', '-node.js');\n                break;\n              case 'es':\n              case 'amd':\n                dest = bundle.dest.replace('.js', `-${format}.js`);\n                break;\n              default:\n                break;\n                    // do nothing\n            }\n          }\n          resolve({bundle: bundle, dest: dest, format: format});\n        } catch (err) {\n          reject(err);\n        }\n      });\n    }\n\n    handleFormat(bundle, format = undefined) {\n      return new Promise(resolve => {\n        if (format) {\n          bundle.format = format;\n        }\n        if (bundle.format === 'iife' && !bundle.moduleName) {\n          bundle.moduleName = this.toJsProp(bundle.name);\n        }\n        resolve(bundle);\n      });\n    }\n\n    promiseBundles(config) {\n      return new Promise((resolve, reject) => {\n        let formats = [];\n        let bundles = config.bundles;\n        try {\n          for (let bundle of bundles) {\n            bundle.name = bundle.name || config.name;\n            bundle.babel = bundle.babel || config.babel;\n            bundle.sourceMap = bundle.sourceMap || config.sourceMap;\n            if (config.format && typeof config.format !== 'string' && !bundle.format) {\n              for (let format of config.format) {\n                formats.push(this.handleFormats(bundle, format));\n              }\n            } else if (bundle.format) {\n              formats.push(this.handleFormat(bundle));\n            } else if (!bundle.format) {\n              formats.push(this.handleFormat(bundle, config.format));\n            }\n          }\n          Promise.all(formats).then(bundles => {\n            resolve(bundles);\n          });\n        } catch (err) {\n          reject(err);\n        }\n      });\n    }\n\n  /**\n   * @param {object} config\n   * @param {string} config.src path/to/js\n   * @param {string} config.dest destination to write to\n   * @param {string} config.format format to build ['es', 'iife', 'amd', 'cjs']\n   * @param {string} config.name the name of your element/app\n   * @param {string} config.moduleName the moduleName for your element/app (not needed for es & cjs)\n   * @param {boolean} config.sourceMap Wether or not to build sourceMaps defaults to 'true'\n   * @param {object} config.plugins rollup plugins to use [see](https://github.com/rollup/rollup/wiki/Plugins)\n   */\n    bundle(config = {src: null, dest: 'bundle.js', format: 'iife', name: null, plugins: [], moduleName: null, sourceMap: true}) {\n      let plugins = config.plugins || [];\n      if (config.babel) {\n        const babel = require('rollup-plugin-babel');\n        plugins.push(babel(config.babel));\n      }\n      rollup({\n        entry: `${process.cwd()}/${config.src}`,\n        plugins: plugins,\n        cache: cache,\n        // Use the previous bundle as starting point.\n        onwarn: warning => {\n          warnings.push(warning);\n        }\n      }).then(bundle => {\n        cache = bundle;\n        bundle.write({\n          // output format - 'amd', 'cjs', 'es', 'iife', 'umd'\n          format: config.format,\n          moduleName: config.moduleName,\n          sourceMap: config.sourceMap,\n          dest: `${process.cwd()}/${config.dest}`\n        });\n        logWorker.send(logger._chalk(`${global.config.name}::build finished`, 'cyan'));\n        setTimeout(() => {\n          iterator.next();\n        }, 100);\n      }).catch(err => {\n        const code = err.code;\n        logWorker.send('pauze');\n        logger.error(err);\n        if (code === 'PLUGIN_ERROR' || code === 'UNRESOLVED_ENTRY') {\n          logWorker.kill('SIGINT');\n        } else {\n          logger.warn('trying to resume the build ...');\n          logWorker.send('resume');\n        }\n      });\n    }\n}\n"],"names":[],"mappings":"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"}